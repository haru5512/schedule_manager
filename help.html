<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æº è¨­å®šã‚¬ã‚¤ãƒ‰</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --forest: #2E5C55;
            --soil: #8B5E3C;
            --cream: #FDFBF7;
            --moss: #A3B18A;
        }

        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: var(--cream);
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        h1 {
            font-family: 'Shippori Mincho', serif;
            color: var(--forest);
            text-align: center;
            border-bottom: 2px solid var(--forest);
            padding-bottom: 20px;
            margin-bottom: 40px;
        }

        h2 {
            color: var(--soil);
            border-left: 5px solid var(--moss);
            padding-left: 15px;
            margin-top: 40px;
            background: #fafafa;
            padding: 10px 15px;
            border-radius: 0 8px 8px 0;
        }

        .step-num {
            display: inline-block;
            background: var(--forest);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            margin-right: 10px;
            font-size: 14px;
        }

        ol {
            padding-left: 20px;
        }

        li {
            margin-bottom: 10px;
        }

        pre {
            background: #2d2d2d;
            color: #ccc;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: Consolas, monospace;
            font-size: 13px;
        }

        .copy-btn {
            display: block;
            margin: 10px 0;
            background: var(--forest);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .copy-btn:hover {
            opacity: 0.9;
        }

        .warning {
            background: #fff5f5;
            border: 1px solid #ffcdd2;
            color: #c62828;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }

        .back-link {
            display: block;
            text-align: center;
            margin-top: 40px;
            color: var(--forest);
            text-decoration: none;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>ğŸŒ± Googleé€£æº è¨­å®šã‚¬ã‚¤ãƒ‰</h1>
        <p>ã‚ãªãŸã®æ´»å‹•è¨˜éŒ²ã‚’Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜ã™ã‚‹ãŸã‚ã®è¨­å®šæ‰‹é †ã§ã™ã€‚<br>ã“ã®ãƒšãƒ¼ã‚¸ã‚’è¦‹ãªãŒã‚‰ã€ãƒ‘ã‚½ã‚³ãƒ³ã§è¨­å®šã‚’é€²ã‚ã¦ãã ã•ã„ã€‚</p>

        <h2>æ‰‹é † 1ï¼šã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®æº–å‚™</h2>
        <ol>
            <li>Googleãƒ‰ãƒ©ã‚¤ãƒ–ãªã©ã§ã€<strong>æ–°ã—ã„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ</strong>ã‚’ä½œæˆã—ã¾ã™ã€‚</li>
            <li>åå‰ã¯ä½•ã§ã‚‚OKã§ã™ï¼ˆä¾‹ï¼š<code>æ´»å‹•è¨˜éŒ²DB</code>ï¼‰ã€‚</li>
            <li>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® <strong>ã€Œæ‹¡å¼µæ©Ÿèƒ½ã€ ï¼ ã€ŒApps Scriptã€</strong> ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚<br>ï¼ˆåˆ¥ã®ã‚¿ãƒ–ã§ã‚³ãƒ¼ãƒ‰ç·¨é›†ç”»é¢ãŒé–‹ãã¾ã™ï¼‰</li>
        </ol>

        <h2>æ‰‹é † 2ï¼šã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒ”ãƒš</h2>
        <ol>
            <li>é–‹ã„ãŸç”»é¢ã«ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ï¼ˆ<code>function myFunction...</code>ï¼‰ã‚’ã™ã¹ã¦æ¶ˆã—ã¾ã™ã€‚</li>
            <li>ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ã™ã¹ã¦ã‚³ãƒ”ãƒ¼ã—ã¦ã€è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</li>
        </ol>

        <button class="copy-btn" onclick="copyCode()">ğŸ“‹ ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹</button>

        <pre id="gas-code">const SHEET_NAME = 'db';

function doGet(e) {
  const sheet = getSheet();
  const data = sheet.getDataRange().getValues();
  const headers = data.shift();
  const records = data.map(row => ({
    id: row[0],
    date: formatDate(row[1]),
    time: formatTime(row[2]),
    category: row[3],
    content: row[4],
    place: row[5],
    count: row[6],
    note: row[7]
  })).filter(r => r.id);
  
  return ContentService.createTextOutput(JSON.stringify(records))
    .setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  const sheet = getSheet();
  
  try {
    const jsonString = e.postData.contents;
    const data = JSON.parse(jsonString);

    if (data.action === 'import') {
        const count = importFromCalendar(data.startDate, data.endDate);
        return ContentService.createTextOutput(JSON.stringify({ status: 'success', count: count }))
            .setMimeType(ContentService.MimeType.JSON);
    }

    let records = [];
    if (Array.isArray(data)) {
        records = data;
    } else {
        records = data.records || [];
    }
    
    if (sheet.getLastRow() > 1) {
        sheet.getRange(2, 1, sheet.getLastRow() - 1, sheet.getLastColumn()).clearContent();
    }
    
    if (records.length > 0) {
        const rows = records.map(r => [
        r.id, r.date, r.time, r.category, r.content, r.place, r.count, r.note
        ]);
        sheet.getRange(2, 1, rows.length, rows[0].length).setValues(rows);
    }
    
    return ContentService.createTextOutput(JSON.stringify({ status: 'success', count: records.length }))
        .setMimeType(ContentService.MimeType.JSON);

  } catch (err) {
    return ContentService.createTextOutput(JSON.stringify({ status: 'error', message: err.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function importFromCalendar(startStr, endStr) {
    const sheet = getSheet();
    const start = new Date(startStr);
    const end = new Date(endStr);
    end.setHours(23, 59, 59);

    const events = CalendarApp.getDefaultCalendar().getEvents(start, end);
    const newRows = [];

    events.forEach(e => {
        const d = e.getStartTime();
        const date = Utilities.formatDate(d, Session.getScriptTimeZone(), 'yyyy-MM-dd');
        const time = e.isAllDayEvent() ? '' : Utilities.formatDate(d, Session.getScriptTimeZone(), 'HH:mm');
        
        newRows.push([
            Utilities.getUuid(),
            date,
            time,
            'ãã®ä»–',
            e.getTitle(),
            e.getLocation(),
            '',
            e.getDescription()
        ]);
    });

    if (newRows.length > 0) {
        sheet.getRange(sheet.getLastRow() + 1, 1, newRows.length, newRows[0].length).setValues(newRows);
    }
    return newRows.length;
}

function setup() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  let sheet = ss.getSheetByName(SHEET_NAME);
  if (!sheet) {
    sheet = ss.insertSheet(SHEET_NAME);
    sheet.appendRow(['id', 'date', 'time', 'category', 'content', 'place', 'count', 'note']);
    sheet.getRange(1, 1, 1, 8).setFontWeight('bold').setBackground('#f3f3f3');
    sheet.setFrozenRows(1);
  }
}

function getSheet() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  return ss.getSheetByName(SHEET_NAME) || ss.insertSheet(SHEET_NAME);
}

function formatDate(d) {
  return d ? (typeof d === 'string' ? d : Utilities.formatDate(d, Session.getScriptTimeZone(), 'yyyy-MM-dd')) : '';
}
function formatTime(t) {
  return t ? (typeof t === 'string' ? t : Utilities.formatDate(t, Session.getScriptTimeZone(), 'HH:mm')) : '';
}</pre>

        <p>è²¼ã‚Šä»˜ã‘ãŸã‚‰ã€ãƒ•ãƒ­ãƒƒãƒ”ãƒ¼ãƒ‡ã‚£ã‚¹ã‚¯ã®ã‚¢ã‚¤ã‚³ãƒ³ğŸ’¾ï¼ˆä¿å­˜ï¼‰ã‚’æŠ¼ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚</p>

        <h2>æ‰‹é † 3ï¼šåˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆé‡è¦ï¼‰</h2>
        <p>â€» ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸãŸã‚ã€<strong>ã‚‚ã†ä¸€åº¦ã“ã®æ‰‹é †ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</strong></p>
        <ol>
            <li>ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ã€Œãƒ‡ãƒãƒƒã‚°ã€ã®æ¨ªã«ã‚ã‚‹ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‹ã‚‰ <strong>ã€Œsetupã€</strong> ã‚’é¸ã³ã¾ã™ã€‚</li>
            <li><strong>å®Ÿè¡Œãƒœã‚¿ãƒ³ â–¶</strong> ã‚’æŠ¼ã—ã¾ã™ã€‚</li>
            <li>ã€Œæ‰¿èªãŒå¿…è¦ã§ã™ã€ã¨å‡ºãŸã‚‰ï¼š
                <ul>
                    <li>ã€Œæ¨©é™ã‚’ç¢ºèªã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                    <li>è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é¸æŠ</li>
                    <li><strong>ã€ŒGoogle ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã€</strong> ã®è¨±å¯ã‚’æ±‚ã‚ã¦ãã‚‹ã®ã§ã€ã€Œè¨±å¯ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚</li>
                </ul>
            </li>
            <li>ç”»é¢ä¸‹ã«ã€Œå®Ÿè¡Œå®Œäº†ã€ã¨å‡ºã‚Œã°OKã§ã™ã€‚</li>
        </ol>

        <h2>æ‰‹é † 4ï¼šWebã‚¢ãƒ—ãƒªã¨ã—ã¦å…¬é–‹ï¼ˆæ›´æ–°ï¼‰</h2>
        <p>â€» ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸã‚‰ã€å¿…ãš <strong>ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã®æ›´æ–°ã€ã§ã¯ãªãã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€</strong> ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</p>
        <ol>
            <li>å³ä¸Šã® <strong>ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ ï¼ ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€</strong> ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚</li>
            <li>å·¦ä¸Šã®æ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³âš™ï¸ ï¼ <strong>ã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã€</strong> ã‚’é¸æŠã€‚</li>
            <li>ä»¥ä¸‹ã®é€šã‚Šã«è¨­å®šã—ã¦ãã ã•ã„ï¼ˆã“ã“ãŒé–“é•ãˆã‚„ã™ã„ã§ã™ï¼ï¼‰
                <ul>
                    <li><strong>èª¬æ˜</strong>ï¼š<code>Calendar Import Update</code> ï¼ˆä½•ã§ã‚‚OKï¼‰</li>
                    <li><strong>æ¬¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦å®Ÿè¡Œ</strong>ï¼š<strong>ã€Œè‡ªåˆ† (Me)ã€</strong></li>
                    <li class="warning"><strong>ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼</strong>ï¼š<strong>ã€Œå…¨å“¡
                            (Anyone)ã€</strong><br>â€»ã€ŒGoogleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã¤å…¨å“¡ã€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ã‚·ãƒ³ãƒ—ãƒ«ãªã€Œå…¨å“¡ã€ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</li>
                </ul>
            </li>
            <li><strong>ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€</strong> ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚</li>
            <li>ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ <strong>ã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã€ã®URL</strong> ï¼ˆ<code>https://script.google.com/...</code>
                ã§å§‹ã¾ã‚‹ã‚‚ã®ï¼‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚<br>â€»ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®URLã€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼</li>
        </ol>

        <h2>æ‰‹é † 5ï¼šã‚¢ãƒ—ãƒªã«æ¥ç¶š</h2>
        <ol>
            <li>ã‚¢ãƒ—ãƒªã®è¨­å®šç”»é¢ã«æˆ»ã‚Šã¾ã™ã€‚</li>
            <li>ã‚³ãƒ”ãƒ¼ã—ãŸURLã‚’è²¼ã‚Šä»˜ã‘ã¦ã€ã€Œä¿å­˜ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</li>
            <li>è¨­å®šã«ã‚ã‚‹ <strong>ã€ŒğŸ“¥ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰å–ã‚Šè¾¼ã¿ã€</strong> æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼</li>
            <li class="warning">â€» <strong>2025å¹´6æœˆ1æ—¥ ï½ ä»Šæ—¥</strong> ã®æ—¥ä»˜ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</li>
        </ol>

        <p style="text-align: center; margin-top: 40px;">ã“ã‚Œã§è¨­å®šã¯å®Œäº†ã§ã™ï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸ ğŸ‰</p>

        <a href="javascript:window.close()" class="back-link">é–‰ã˜ã‚‹</a>
    </div>

    <script>
        function copyCode() {
            const code = document.getElementById('gas-code').innerText;
            navigator.clipboard.writeText(code).then(() => {
                alert('ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼Scriptã‚¨ãƒ‡ã‚£ã‚¿ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
            });
        }
    </script>

</body>

</html>